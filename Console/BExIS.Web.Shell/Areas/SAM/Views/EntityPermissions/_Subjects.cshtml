@using BExIS.Modules.Sam.UI.Models
@using BExIS.Security.Entities.Authorization
@using Telerik.Web.Mvc.UI

@model EntityInstanceModel

<style>
    #grid_subjects tbody > tr:hover {
    background-color: #eff7f6;
    }

    #grid_subjects tbody > tr:active,
    #grid_subjects tbody > tr.t-state-selected
    {
        background-color: #d2e8e3;
    }
</style>

@(Html.Telerik().Grid<EntityPermissionGridRowModel>()
    .Name("grid_subjects")
    .DataKeys(keys =>
    {
        keys.Add(m => m.Id);
    })
    .Columns(columns =>
    {
        columns.Bound(m=>m.Id)
            .Width("15%")
            .Title("Subject Id");
        columns.Bound(m=>m.DisplayName)
            .Width("15%")
            .Title("Subject Name");
        columns.Bound(m => m.Type)
            .Width("15%")
            .Title("Subject Type")
            .Filterable(false);

        foreach (var rightType in Enum.GetValues(typeof(RightType)).Cast<RightType>())
        {
            columns.Bound(m => m.EffectiveRights)
                        .ClientTemplate("<input type='checkbox' data-subjectid='<#= Id #>' data-entityid='" + Model.EntityId + "' data-instanceid='" + Model.InstanceId + "' data-righttype='" + (int)rightType + "' <#= (Rights &" + (int)rightType + ") > 0 ? checked='checked' : '' #> /> <input type='checkbox' data-subjectid='<#= Id #>' data-entityid='" + Model.EntityId + "' data-instanceid='" + Model.InstanceId + "' data-righttype='" + (int)rightType + "' <#= (EffectiveRights &" + (int)rightType + ") > 0 ? checked='checked' : '' #> disabled />")
                               .Title(rightType.ToString())
                               .Width("11%")
                               .Filterable(false)
                               .Sortable(false)
                               .HtmlAttributes(new { style = "text-align:center" });
        }
    })
      .DataBinding(dataBinding => dataBinding
          .Ajax()
          .OperationMode(GridOperationMode.Server)
          .Select("Subjects_Select", "EntityPermissions", new { Model.EntityId, Model.InstanceId })
      )
      .Filterable()
      .Pageable(pageable =>
      {
          pageable.PageSize(50, new[] { 10, 20, 50, 100, 200 });
          pageable.Style(GridPagerStyles.NextPreviousAndNumeric | GridPagerStyles.PageSizeDropDown);
          pageable.Position(GridPagerPosition.Bottom);
      })
      .Sortable(sortable => sortable
          .OrderBy(orderby => orderby
              .Add(m => m.DisplayName)
              .Ascending()
          )
      )
    .ClientEvents(events =>
    {
        events.OnRowSelect("grid_subjects_onRowSelect");
        events.OnDataBound("grid_subjects_onDataBound");
    })
    .Selectable()
)